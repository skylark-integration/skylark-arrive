/**
 * skylark-arrive - A version of arrive that ported to running on skylarkjs ui.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-arrive/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-jquery"],function(e,t){"use strict";if(window.MutationObserver&&"undefined"!=typeof HTMLElement){var n,r=0,i=(n=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector,{matchesSelector:function(e,t){return e instanceof HTMLElement&&n.call(e,t)},addMethod:function(e,t,n){var r=e[t];e[t]=function(){return n.length==arguments.length?n.apply(this,arguments):"function"==typeof r?r.apply(this,arguments):void 0}},callCallbacks:function(e,t){t&&t.options.onceOnly&&1==t.firedElems.length&&(e=[e[0]]);for(var n,r=0;n=e[r];r++)n&&n.callback&&n.callback.call(n.elem,n.elem);t&&t.options.onceOnly&&1==t.firedElems.length&&t.me.unbindEventWithSelectorAndCallback.call(t.target,t.selector,t.callback)},checkChildNodesRecursively:function(e,t,n,r){for(var o,l=0;o=e[l];l++)n(o,t,r)&&r.push({callback:t.callback,elem:o}),o.childNodes.length>0&&i.checkChildNodesRecursively(o.childNodes,t,n,r)},mergeArrays:function(e,t){var n,r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);for(n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);return r},toElementsArray:function(e){return void 0===e||"number"==typeof e.length&&e!==window||(e=[e]),e}}),o=function(){var e=function(){this._eventsBucket=[],this._beforeAdding=null,this._beforeRemoving=null};return e.prototype.addEvent=function(e,t,n,r){var i={target:e,selector:t,options:n,callback:r,firedElems:[]};return this._beforeAdding&&this._beforeAdding(i),this._eventsBucket.push(i),i},e.prototype.removeEvent=function(e){for(var t,n=this._eventsBucket.length-1;t=this._eventsBucket[n];n--)if(e(t)){this._beforeRemoving&&this._beforeRemoving(t);var r=this._eventsBucket.splice(n,1);r&&r.length&&(r[0].callback=null)}},e.prototype.beforeAdding=function(e){this._beforeAdding=e},e.prototype.beforeRemoving=function(e){this._beforeRemoving=e},e}(),l=function(e,t){var n=new o,r=this,l={fireOnAttributesModification:!1};return n.beforeAdding(function(n){var i,o=n.target;o!==window.document&&o!==window||(o=document.getElementsByTagName("html")[0]),i=new MutationObserver(function(e){t.call(this,e,n)});var l=e(n.options);i.observe(o,l),n.observer=i,n.me=r}),n.beforeRemoving(function(e){e.observer.disconnect()}),this.bindEvent=function(e,t,r){t=i.mergeArrays(l,t);for(var o=i.toElementsArray(this),c=0;c<o.length;c++)n.addEvent(o[c],e,t,r)},this.unbindEvent=function(){var e=i.toElementsArray(this);n.removeEvent(function(t){for(var n=0;n<e.length;n++)if(void 0===this||t.target===e[n])return!0;return!1})},this.unbindEventWithSelectorOrCallback=function(e){var t,r=i.toElementsArray(this),o=e;t="function"==typeof e?function(e){for(var t=0;t<r.length;t++)if((void 0===this||e.target===r[t])&&e.callback===o)return!0;return!1}:function(t){for(var n=0;n<r.length;n++)if((void 0===this||t.target===r[n])&&t.selector===e)return!0;return!1},n.removeEvent(t)},this.unbindEventWithSelectorAndCallback=function(e,t){var r=i.toElementsArray(this);n.removeEvent(function(n){for(var i=0;i<r.length;i++)if((void 0===this||n.target===r[i])&&n.selector===e&&n.callback===t)return!0;return!1})},this},c=new function(){var e={fireOnAttributesModification:!1,onceOnly:!1,existing:!1};function t(e,t,n){return!(!i.matchesSelector(e,t.selector)||(void 0===e._id&&(e._id=r++),-1!=t.firedElems.indexOf(e._id))||(t.firedElems.push(e._id),0))}var n=(c=new l(function(e){var t={attributes:!1,childList:!0,subtree:!0};return e.fireOnAttributesModification&&(t.attributes=!0),t},function(e,n){e.forEach(function(e){var r=e.addedNodes,o=e.target,l=[];null!==r&&r.length>0?i.checkChildNodesRecursively(r,n,t,l):"attributes"===e.type&&t(o,n)&&l.push({callback:n.callback,elem:o}),i.callCallbacks(l,n)})})).bindEvent;return c.bindEvent=function(t,r,o){void 0===o?(o=r,r=e):r=i.mergeArrays(e,r);var l=i.toElementsArray(this);if(r.existing){for(var c=[],a=0;a<l.length;a++)for(var s=l[a].querySelectorAll(t),u=0;u<s.length;u++)c.push({callback:o,elem:s[u]});if(r.onceOnly&&c.length)return o.call(c[0].elem,c[0].elem);setTimeout(i.callCallbacks,1,c)}n.call(this,t,r,o)},c},a=new function(){var e={};function t(e,t){return i.matchesSelector(e,t.selector)}var n=(a=new l(function(){return{childList:!0,subtree:!0}},function(e,n){e.forEach(function(e){var r=e.removedNodes,o=[];null!==r&&r.length>0&&i.checkChildNodesRecursively(r,n,t,o),i.callCallbacks(o,n)})})).bindEvent;return a.bindEvent=function(t,r,o){void 0===o?(o=r,r=e):r=i.mergeArrays(e,r),n.call(this,t,r,o)},a};t&&d(t.fn),d(HTMLElement.prototype),d(NodeList.prototype),d(HTMLCollection.prototype),d(HTMLDocument.prototype),d(Window.prototype);var s={};return u(c,s,"unbindAllArrive"),u(a,s,"unbindAllLeave"),e.attach("intg.arrive",s)}function u(e,t,n){i.addMethod(t,n,e.unbindEvent),i.addMethod(t,n,e.unbindEventWithSelectorOrCallback),i.addMethod(t,n,e.unbindEventWithSelectorAndCallback)}function d(e){e.arrive=c.bindEvent,u(c,e,"unbindArrive"),e.leave=a.bindEvent,u(a,e,"unbindLeave")}});
//# sourceMappingURL=sourcemaps/arrive.js.map
